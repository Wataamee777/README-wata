<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>PixPin - 簡易短縮サービス</title>

<link rel="icon" href="https://wataamee777.f5.si/assets/favicon.ico" />

<!-- OGP -->
<meta property="og:type" content="website">
<meta property="og:title" content="PixPin - テキスト短縮サービス">
<meta property="og:description" content="テキスト・画像・URLを短縮して簡単に共有できるサービス">
<meta property="og:image" content="https://wataamee777.f5.si/assets/Yukkuri.png">
<meta property="og:url" content="https://wataamee777.f5.si/pixpin/">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="PixPin - テキスト短縮サービス">
<meta name="twitter:description" content="テキスト・画像・URLを短縮して簡単に共有できるサービス">
<meta name="twitter:image" content="https://wataamee777.f5.si/assets/Yukkuri.png">
  
<style>
body { display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:100vh; font-family:sans-serif; background:#eef; margin:0; padding:20px; }
#mainPage,#displayPage { width:100%; max-width:480px; background:#fff; border-radius:12px; padding:20px; box-shadow:0 6px 16px rgba(0,0,0,0.15); margin-top:16px; }
textarea,input,select,button { width:100%; margin:6px 0; padding:8px; border-radius:6px; border:1px solid #ccc; font-size:14px; }
button { cursor:pointer; background:#4facfe; color:#fff; border:none; }
#displayArea img { max-width:90%; border-radius:8px; margin-top:8px; }
.shareUrlContainer { display:flex; gap:4px; margin-top:6px; align-items:center; }
.shareUrlContainer input { flex:1; padding:6px; border:1px solid #ccc; border-radius:6px; font-size:14px; }
#copyBtn { padding:6px 10px; font-size:13px; background:#00bcd4; }
#fileWarning { color:red; font-size:0.85rem; margin-bottom:4px; display:none; }
</style>
</head>
<body>

<h2>PixPin - 簡易短縮サービス</h2>

<div id="mainPage">
<textarea id="valueInput" placeholder="文字列やURLを入力"></textarea>
<div id="fileContainer">
<div id="fileWarning">typeをImageに変更してください</div>
<input type="file" id="fileInput" style="display:none;">
</div>
<select id="typeSelect">
<option value="text">Text</option>
<option value="image">Image</option>
<option value="url">URL</option>
</select>
<button id="shareBtn">共有</button>
<div id="shareUrl" class="shareUrlContainer"></div>
</div>

<div id="displayPage" style="display:none;">
<div id="displayArea"></div>
<button id="actionBtn"></button>
</div>

<script>
// 簡易 Base62
const chars='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
function encodeBase62(str){
  const bytes=new TextEncoder().encode(str);
  let hex=''; bytes.forEach(b=>hex+=b.toString(16).padStart(2,'0'));
  let num=BigInt('0x'+hex);
  let s='';
  while(num>0n){ s=chars[Number(num%62n)]+s; num/=62n; }
  return s||'0';
}
function decodeBase62(s){
  let num=0n;
  for(const c of s) num=num*62n+BigInt(chars.indexOf(c));
  let hex=num.toString(16);
  if(hex.length%2) hex='0'+hex;
  let bytes=[];
  for(let i=0;i<hex.length;i+=2) bytes.push(parseInt(hex.substr(i,2),16));
  return new TextDecoder().decode(new Uint8Array(bytes));
}

// ファイル -> Base64
function fileToBase64(file){ return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=()=>rej(r.error); r.readAsDataURL(file); }); }

// DOM操作
const typeSelect=document.getElementById('typeSelect');
const fileInput=document.getElementById('fileInput');
const fileWarning=document.getElementById('fileWarning');

typeSelect.addEventListener('change',()=>{
  if(typeSelect.value==='image'){ fileInput.style.display='block'; fileInput.disabled=false; fileWarning.style.display='none'; }
  else{ fileInput.style.display='block'; fileInput.disabled=true; fileInput.value=''; fileWarning.style.display=typeSelect.value==='text'?'block':'none'; }
});

document.getElementById('shareBtn').onclick=async()=>{
  let value=document.getElementById('valueInput').value;
  const type=typeSelect.value;
  if(type==='image'){ 
    const file=fileInput.files[0]; 
    if(!file){ alert("画像を選んでください"); return; } 
    value=await fileToBase64(file); 
  }
  const short=type.charAt(0)+encodeBase62(value);
  const shareLink=`https://wataamee777.f5.si/pixpin/?share=${short}`;
  document.getElementById('shareUrl').innerHTML=
    `<input type="text" value="${shareLink}" readonly><button id="copyBtn">コピー</button>`;
  document.getElementById('copyBtn').onclick=()=>navigator.clipboard.writeText(shareLink);
}

// 表示ページ
const params=new URLSearchParams(location.search);
if(params.has('share')){
  const s=params.get('share');
  const typeChar=s.charAt(0);
  const valueStr=decodeBase62(s.slice(1));
  document.getElementById('mainPage').style.display='none';
  const displayArea=document.getElementById('displayArea');
  const actionBtn=document.getElementById('actionBtn');

  if(typeChar==='t' || typeChar==='u'){ 
    displayArea.textContent=valueStr; 
    actionBtn.textContent='コピー'; 
    actionBtn.onclick=()=>navigator.clipboard.writeText(valueStr);
  } else if(typeChar==='i'){ 
    const img=document.createElement('img'); 
    img.src=valueStr; 
    displayArea.appendChild(img); 
    actionBtn.textContent='DL'; 
    actionBtn.onclick=()=>{ const a=document.createElement('a'); a.href=valueStr; a.download=''; a.click(); };
  }
  document.getElementById('displayPage').style.display='block';
}
</script>
</body>
</html>
