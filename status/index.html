<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚µãƒ¼ãƒ“ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
:root { --ok: #22c55e; --warn: #f59e0b; --error: #ef4444; --bg: #020617; --card: #0f172a; --text: #e5e7eb; --sub: #94a3b8; }
* { box-sizing: border-box; }
body { margin: 0; padding: 20px; font-family: system-ui, sans-serif; background: var(--bg); color: var(--text); line-height: 1.5; }
.container { max-width: 600px; margin: 0 auto; }
h1 { margin-bottom: 24px; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
#status-list { display: grid; gap: 16px; }
.card { background: var(--card); border-radius: 12px; padding: 18px; border-left: 6px solid; box-shadow: 0 10px 25px -5px rgba(0,0,0,0.4); animation: fadeIn .3s ease-out; }
.ok { border-color: var(--ok); } .warn { border-color: var(--warn); } .error { border-color: var(--error); }
.header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
.name { font-weight: 700; font-size: 1.1rem; word-break: break-all; }
.badge { padding: 2px 10px; border-radius: 999px; font-size: .75rem; font-weight: 700; }
.ok .badge { background: #14532d; color: #86efac; } .warn .badge { background: #78350f; color: #fde68a; } .error .badge { background: #7f1d1d; color: #fecaca; }
.meta { font-size: 0.85rem; color: var(--sub); display: grid; grid-template-columns: auto 1fr; gap: 6px 16px; }
.meta-label { font-weight: 500; opacity: 0.8; }
footer { margin-top: 40px; text-align: center; font-size: .75rem; color: var(--sub); }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>
<div class="container">
  <h1>ğŸ“¡ ã‚µãƒ¼ãƒ“ã‚¹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</h1>
  <div id="status-list"><div style="color: var(--sub)">èª­ã¿è¾¼ã¿ä¸­â€¦</div></div>
  <footer id="footer">è‡ªå‹•æ›´æ–°: 5åˆ†ã”ã¨ / GitHub Actions</footer>
</div>

<script>
const statusListEl = document.getElementById("status-list");
function escape(str) { return str ? String(str).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":"&#39;"}[m])) : ""; }

async function fetchStatus() {
  try {
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’é¿ã‘ã‚‹ãŸã‚ã«ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’ä»˜ä¸
    const res = await fetch("./status.json?t=" + Date.now(), { cache: "no-store" });
    if (!res.ok) throw new Error("HTTPã‚¨ãƒ©ãƒ¼: " + res.status);
    
    const data = await res.json();
    statusListEl.innerHTML = "";
    
    for (const name in data) {
      const item = data[name];
      // statusã‹ã‚‰ã‚¯ãƒ©ã‚¹ã¨ãƒ©ãƒ™ãƒ«ã‚’æ±ºå®š
      const s = item.status || "down";
      const cls = (s === "ok") ? "ok" : (s === "warning" ? "warn" : "error");
      const label = s.toUpperCase();
      
      let html = "";
      if (item.type === "site") {
        html = `<div class="meta-label">HTTP</div><div>${item.http || "â€”"}</div>
                <div class="meta-label">MS</div><div>${item.http_ms ?? "â€”"} ms</div>
                <div class="meta-label">Update</div><div>${escape(item.checked_at?.split('T')[1].split('Z')[0])}</div>`;
      } else {
        const isObj = item.raw && typeof item.raw === 'object';
        html = `<div class="meta-label">Shards</div><div>${isObj ? (item.raw.shards?.length || 0) : 0} active</div>
                <div class="meta-label">Mode</div><div>${isObj ? "Discord API" : "Maintenance"}</div>
                <div class="meta-label">Update</div><div>${isObj ? escape(item.raw.updatedAt) : "Down"}</div>`;
      }

      statusListEl.insertAdjacentHTML("beforeend", `
        <div class="card ${cls}"><div class="header"><div class="name">${escape(name)}</div><div class="badge">${label}</div></div>
        <div class="meta">${html}</div></div>`);
    }
  } catch (e) {
    statusListEl.innerHTML = `
      <div class="card error">
        <div class="name">å–å¾—å¤±æ•—</div>
        <div class="meta">
          <div class="meta-label">Error</div><div>${escape(e.message)}</div>
          <div class="meta-label">Check</div><div>status.json ã‚’ç›´æ¥é–‹ã„ã¦ç¢ºèªã—ã¦ãã ã•ã„</div>
        </div>
      </div>`;
  }
}
fetchStatus();
setInterval(fetchStatus, 300000);
</script>
</body>
</html>
