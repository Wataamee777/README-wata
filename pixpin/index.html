<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>PixPin - テキスト短縮サービス</title>
<link rel="icon" href="https://wataamee777.f5.si/assets/favicon.ico" />

<!-- OGP -->
<meta property="og:type" content="website">
<meta property="og:title" content="PixPin - テキスト短縮サービス">
<meta property="og:description" content="テキスト・画像・URLを短縮して簡単に共有できるサービス">
<meta property="og:image" content="https://wataamee777.f5.si/assets/Yukkuri.png">
<meta property="og:url" content="https://wataamee777.f5.si/pixpin/">

<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="PixPin - テキスト短縮サービス">
<meta name="twitter:description" content="テキスト・画像・URLを短縮して簡単に共有できるサービス">
<meta name="twitter:image" content="https://wataamee777.f5.si/assets/Yukkuri.png">

<style>
body {
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  min-height:100vh;
  font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #f0f4ff, #e0f7ff);
  margin:0;
  padding:20px;
}

h2 { margin-bottom:16px; }

#mainPage, #displayPage {
  width:100%;
  max-width:480px;
  background:#fff;
  border-radius:16px;
  padding:24px;
  box-shadow: 0 8px 24px rgba(0,0,0,0.15);
  box-sizing:border-box;
  transition: transform 0.2s ease;
}
#mainPage:hover, #displayPage:hover {
  transform: translateY(-4px);
}

textarea, input, select {
  width:100%;
  margin:10px 0;
  padding:12px;
  border:1px solid #ccc;
  border-radius:8px;
  font-size:1rem;
  transition: border 0.2s, box-shadow 0.2s;
}
textarea:focus, input:focus, select:focus {
  border-color:#4facfe;
  box-shadow:0 0 8px rgba(79,172,254,0.5);
  outline:none;
}

button {
  margin-top:14px;
  padding:12px 24px;
  font-size:1rem;
  font-weight:600;
  border:none;
  border-radius:12px;
  cursor:pointer;
  background: linear-gradient(90deg, #4facfe, #00f2fe);
  color:#fff;
  transition: transform 0.2s, box-shadow 0.2s;
}
button:hover {
  transform: translateY(-2px);
  box-shadow:0 6px 16px rgba(0,0,0,0.25);
}

#displayArea {
  margin-top:32px;
  text-align:center;
  word-break:break-all;
  padding:16px;
  background:#f5f5f5;
  border-radius:12px;
  box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
}

img {
  max-width:90vw;
  border-radius:12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  margin-top:12px;
}

label { display:flex; align-items:center; gap:6px; font-size:0.9rem; margin-top:6px; }

.shareUrlContainer { margin-top:12px; display:flex; gap:6px; flex-wrap:wrap; }
.shareUrlContainer input { flex:1; padding:8px; border-radius:8px; border:1px solid #ccc; }

#fileWarning { color:red; font-size:0.9rem; margin-bottom:4px; display:none; }
</style>
</head>
<body>

<h2>PixPin - テキスト短縮サービス</h2>

<div id="mainPage">
  <textarea id="valueInput" placeholder="文字列やURLを入力"></textarea>

  <div id="fileContainer">
    <div id="fileWarning">imageに変更してください</div>
    <input type="file" id="fileInput">
  </div>

  <select id="typeSelect">
    <option value="text">Text</option>
    <option value="image">Image</option>
    <option value="url">URL</option>
  </select>

  <label><input type="checkbox" id="autoRedirect">自動リダイレクト(URLのみ)</label>
  <input type="text" id="pinInput" placeholder="PIN(任意)">
  <button id="shareBtn">共有</button>

  <div id="shareUrl" class="shareUrlContainer"></div>
</div>

<div id="displayPage" style="display:none;">
  <div id="displayArea"></div>
  <button id="actionBtn"></button>
</div>

<script>
// --- Base62 ---
const chars = '0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
function encodeBase62(num){
  let result='';
  while(num>0){ result=chars[num%62]+result; num=Math.floor(num/62);}
  return result.padStart(8,'0');
}

// --- 簡易ハッシュ ---
function hash(str){ let h=0; for(let i=0;i<str.length;i++){ h=(h*31+str.charCodeAt(i))>>>0; } return h; }

// --- クライアント内データストレージ ---
const storage = {};

// --- ファイルをBase64に ---
function fileToBase64(file){
  return new Promise((res,rej)=>{
    const reader = new FileReader();
    reader.onload = ()=>res(reader.result);
    reader.onerror = ()=>rej(reader.error);
    reader.readAsDataURL(file);
  });
}

// --- ファイル表示制御 & 自動リダイレクト制御 ---
const typeSelect = document.getElementById('typeSelect');
const fileInput = document.getElementById('fileInput');
const fileWarning = document.getElementById('fileWarning');
const autoRedirectCheck = document.getElementById('autoRedirect');

fileInput.style.display = 'none';
fileWarning.style.display = 'none';
fileInput.disabled = true;
autoRedirectCheck.disabled = true;

typeSelect.addEventListener('change', ()=>{
  if(typeSelect.value === 'image'){
    fileInput.style.display = 'block';
    fileInput.disabled = false;
    fileWarning.style.display = 'none';
  } else {
    fileInput.style.display = 'block';
    fileInput.disabled = true;
    fileInput.value = '';
    fileWarning.style.display = typeSelect.value === 'text' ? 'block' : 'none';
  }

  // 自動リダイレクトONはURLのみ
  if(typeSelect.value === 'url'){
    autoRedirectCheck.disabled = false;
  } else {
    autoRedirectCheck.checked = false;
    autoRedirectCheck.disabled = true;
  }
});

// --- 共有ボタン ---
document.getElementById('shareBtn').onclick = async ()=>{
  let value = document.getElementById('valueInput').value;
  const type = document.getElementById('typeSelect').value;
  const autoRedirect = document.getElementById('autoRedirect').checked;
  const pinInput = document.getElementById('pinInput').value;
  const pin = pinInput ? hash(pinInput).toString() : null;

  if(type==='image'){
    const file = document.getElementById('fileInput').files[0];
    if(!file) return; // 赤文字で警告表示済み
    value = await fileToBase64(file);
  }

  const obj = { value, type, setting: { autoRedirect, pin } };
  const id = encodeBase62(Date.now());
  storage[id] = obj;

  const shareLink = `https://wataamee777.f5.si/pixpin/?share=${id}`;
  const shareDiv = document.getElementById('shareUrl');
  shareDiv.innerHTML = `
    <input type="text" value="${shareLink}" readonly>
    <button id="copyBtn">コピー</button>
  `;
  document.getElementById('copyBtn').onclick = ()=>{
    navigator.clipboard.writeText(shareLink);
    alert("コピーしました！");
  };
}

// --- 表示ページ ---
const params = new URLSearchParams(location.search);
if(params.has('share')){
  const obj = storage[params.get('share')];
  if(obj){
    document.getElementById('mainPage').style.display='none';
    const displayArea = document.getElementById('displayArea');
    const actionBtn = document.getElementById('actionBtn');

    if(obj.setting.pin){
      const pinVal = prompt("PINを入力してください:");
      if(hash(pinVal).toString()!==obj.setting.pin){
        displayArea.textContent="PINが違います";
        actionBtn.style.display="none";
      }
    }

    if(obj.type==='text'){
      displayArea.textContent = obj.value;
      actionBtn.textContent='コピー';
      actionBtn.onclick = ()=>navigator.clipboard.writeText(obj.value);
    } else if(obj.type==='image'){
      const img = document.createElement('img');
      img.src = obj.value;
      displayArea.appendChild(img);
      actionBtn.textContent='DL';
      actionBtn.onclick = ()=>{
        const a = document.createElement('a');
        a.href = obj.value;
        a.download='';
        a.click();
      }
    } else if(obj.type==='url'){
      displayArea.textContent = obj.value;
      if(obj.setting.autoRedirect) location.href = obj.value;
      else{ actionBtn.textContent='移動'; actionBtn.onclick = ()=>location.href=obj.value; }
    }

    document.getElementById('displayPage').style.display='block';
  }
}
</script>

</body>
</html>
